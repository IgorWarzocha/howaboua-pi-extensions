{
  "id": "08a53f34",
  "title": "Assess reusing powerbar token counters in tool call cards",
  "tags": [
    "pi-hash",
    "tool-ui",
    "token-usage",
    "integration"
  ],
  "status": "open",
  "created_at": "2026-02-12T13:31:15.159Z"
}

Goal
- Determine whether existing powerbar token counters can be reused for tool-call token display, so pi-hash does NOT duplicate token estimation logic.

Scope
- Inspect active powerbar extension(s) and any shared usage/token APIs exposed by Pi.
- Verify whether per-turn/per-message token usage can be accessed from extension hooks used by pi-hash tool renderers.
- Evaluate whether usage granularity supports tool-call-level attribution or only model-response-level totals.
- Identify lowest-overhead integration path to surface token data in tool call/result headers.

Questions to answer
1. What token metrics are already available in powerbar (input/output/total, rolling window, model/provider-specific)?
2. Are these metrics accessible cross-extension at runtime, or only within powerbar rendering context?
3. Can pi-hash access authoritative usage without re-tokenizing tool payload text?
4. If direct access is unavailable, can powerbar publish a shared state/event that pi-hash can subscribe to?
5. What are the consistency/latency constraints (when does token data become available relative to tool_call and tool_result rendering)?
6. What fallback behavior is required if powerbar is disabled?

Deliverables
- PASS/FAIL matrix for each integration option:
  - Direct API hook into Pi usage metrics
  - Cross-extension shared state/event bridge from powerbar
  - Heuristic fallback in pi-hash (only if no reliable hook)
- Recommended implementation plan with estimated complexity and risk.
- Explicit decision on whether duplicate token estimation in pi-hash MUST be avoided and how.

Acceptance criteria
- Recommendation MUST prioritize single-source token accounting (powerbar/Pi) over duplicate estimation.
- Proposed design SHOULD avoid extra per-tool-call tokenization overhead.
- Outcome MUST include concrete file/hook touchpoints for implementation if feasible.
