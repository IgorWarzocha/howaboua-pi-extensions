{
  "id": "30f9775c",
  "title": "[Phase 2] Self-healing: Content auto-corrections",
  "tags": [
    "pi-hash",
    "phase-2",
    "self-healing",
    "indent",
    "merge-detection"
  ],
  "status": "closed",
  "created_at": "2026-02-12T21:25:47.656Z",
  "assigned_to_session": "5d994b6f-5c75-4f28-8a94-ed305756b8c1"
}

## Completed

Content auto-corrections have been implemented in the new `healing.ts` module.

### Implementation

Created `src/healing.ts` with all self-healing utilities:

1. **Whitespace/content comparison utilities**:
   - `equalsIgnoringWhitespace(a, b)` - compare strings ignoring whitespace
   - `stripAllWhitespace(s)` - strip all whitespace from string
   - `stripTrailingContinuationTokens(s)` - strip trailing continuation tokens
   - `stripMergeOperatorChars(s)` - strip merge operator chars
   - `leadingWhitespace(s)` - get leading whitespace

2. **Indent restoration**:
   - `restoreLeadingIndent(templateLine, line)` - restore indent from template
   - `restoreIndentForPairedReplacement(oldLines, newLines)` - restore indent for paired replacements

3. **Merge detection**:
   - `maybeExpandSingleLineMerge()` - detect when model merged multiple lines into one

4. **Echo stripping**:
   - `stripRangeBoundaryEcho()` - strip echo of range boundaries

5. **Wrapped line restoration**:
   - `restoreOldWrappedLines()` - restore lines that were re-wrapped

6. **Confusable hyphen normalization**:
   - `normalizeConfusableHyphens(s)` - normalize different hyphen chars
   - `normalizeConfusableHyphensInLines(lines)` - normalize in array of lines

7. **Core healing function**:
   - `computeReplacementsWithHealing()` - apply all healing strategies

### Files

- `pi-extensions-dev/pi-hash/src/healing.ts` - new file with self-healing utilities
- `pi-extensions-dev/pi-hash/src/apply.ts` - imports from healing.ts

### Acceptance Criteria Met

- [x] Indent preserved when model forgets
- [x] Line merge detected and handled
- [x] Echo lines stripped from additions
