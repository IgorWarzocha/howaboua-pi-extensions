{
  "id": "590a4830",
  "title": "PI-NESTED-AGENTS-MD: Implement user-only info display and /learn command",
  "tags": [],
  "status": "closed",
  "created_at": "2026-02-12T00:31:44.630Z"
}

Create a new extension `pi-nested-agents-md` forked from `pi-subdir-context` with enhanced features for managing directory-level knowledge.

### 1. Fork and Rename
- Copy `pi-subdir-context` to `.pi/extensions-dev/pi-nested-agents-md/`.
- Update `package.json` with the new name and description.

### 2. User-Only Info Display
- **Requirement**: When a nested `AGENTS.md` is loaded during a `read` tool call, display a "greyed out" / dimmed info message to the user.
- **Behavior**: The message MUST say: `AGENTS.md loaded from <relative_path>`.
- **Visibility**: This info MUST be visible in the TUI (using dimmed/subtle styling) but MUST NOT be passed to the model as part of the tool result content.
- **Implementation**: Hook into the `tool_result` event for the `read` tool. Use `ctx.ui` to display the message while ensuring it doesn't leak into the `additions` sent to the model.

### 3. `/learn` Slash Command
- **Requirement**: Implement a `/learn` slash command that mirrors the `/workflow` capture flow from `pi-workflows-tool`.
- **Behavior**: Running `/learn` MUST inject a system instruction into the session that directs the agent to analyze the session and extract non-obvious learnings into the most relevant `AGENTS.md` file (package-level, feature-level, or root).
- **Instruction Logic**:
    - Agent MUST analyze the session for non-obvious discoveries (hidden relationships, execution paths, debugging breakthroughs).
    - Agent MUST place learnings as close to the code as possible (nested `AGENTS.md`).
    - Agent MUST NOT update repository-level `AGENTS.md` if a nested one is more appropriate.
    - Entries MUST be 1-3 lines per insight.
- **Implementation**: Register the `/learn` command and have its handler call `pi.sendUserMessage()` with the specialized \"Extract non-obvious learnings\" instructions.

### 4. Nested Creation Workflow
- When the agent decides to add a learning to a directory that lacks an `AGENTS.md`, it SHOULD be encouraged to create one.
- Provide expanded UI feedback (via `ctx.ui.notify` or similar) when `AGENTS.md` files are created or updated surgically by the agent, making the process transparent to the user.

### 5. Integration
- Maintain the current behavior of automatically loading parent `AGENTS.md` files into the context of `read` results.
- Ensure compatibility with existing TUI theming for the dimmed display.

**Reference**: 
- Source: `pi-extensions-repos/pi-subdir-context/`
- Pattern: `pi-extensions-dev/pi-workflows-tool/src/index.ts` (specifically `WORKFLOW_COMMAND_INSTRUCTIONS` and `/workflow` handler).
