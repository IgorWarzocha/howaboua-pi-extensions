---
id: c93a0b57
type: spec
title: Hidden cli invocation gate
tags:
  - cli
  - security
  - orchestration
status: open
created_at: 2026-02-14T13:12:00.000Z
modified_at: 2026-02-14T13:12:00.000Z
assigned_to_session: null
agent_rules: "MUST block direct model CLI invocation. MUST allow only GUI-internal calls with internal invocation argument. MUST emit explicit failure guidance for unauthorized calls."
links:
  root_abs: /home/igorw/Work/pi/pi-extensions-dev/pi-todos
  prds:
    - plans/prds/a1f49c2e.md
  specs: []
  todos:
    - plans/todos/e3bf91aa.md
  reads:
    - plans/prds/a1f49c2e.md
checklist: []
template: true
---

## Objective

Specify a hidden orchestration layer where CLI usage is restricted to internal GUI execution only.

## Scope

- internal invocation argument requirements
- unauthorized error response requirements
- extension adapter behavior for command execution and parsing
- repository discovery and worktree creation decision flow

## Non-Goals

- exposing CLI commands for direct model invocation
- handling lifecycle closure from CLI calls

## Constraints

- unauthorized calls MUST fail fast
- outputs MUST remain deterministic and machine-consumable
- repository scan MUST search cwd and descendants for git repositories
- multiple repositories MUST trigger user repo-selection modal
- no repository found MUST trigger init prompt and optional auto init with initial commit

## Deliverables

- invocation gate spec
- error contract spec
- adapter contract spec

## Acceptance Criteria

- direct model calls are blocked
- GUI and extension can invoke internal commands successfully

## Risks

- poor token handling can break internal execution
- ambiguous errors can confuse debugging

## Implementation Notes

Keep error texts short and explicit, and include remediation guidance in every blocked call response.
Treat this file as a template blueprint for generated spec files.

## Verification Plan

Test authorized and unauthorized invocation paths, and verify output contract stability.
