---
id: a1f49c2e
kind: prd
title: Agent-safe planning system
tags:
  - planning
  - workflow
  - gui
status: open
created_at: 2026-02-14T13:10:00.000Z
modified_at: 2026-02-14T13:10:00.000Z
assigned_to_session: null
agent_rules: "MUST follow RFC 2119 language. MUST NOT change status unless user explicitly requests closure. MUST update checklist done booleans while working. MUST treat linked files as REQUIRED reading before implementation. MUST NOT create checklist items for kind=prd or kind=spec."
worktree:
  enabled: true
  branch: feat/prd-agent-safe-planning
links:
  root_abs: /home/igorw/Work/pi/pi-extensions-dev/pi-todos
  prds: []
  specs:
    - plans/specs/b74e2fd1.md
    - plans/specs/c93a0b57.md
  todos:
    - plans/todos/d5e8a10c.md
    - plans/todos/e3bf91aa.md
    - plans/todos/f19c6d4b.md
  reads: []
checklist: []
template: true
---

## Objective

Define and implement a unified planning document system with PRD, spec, and todo files that supports safe model execution under user-controlled review.

## Scope

- one shared frontmatter schema across prd, spec, and todo
- GUI actions for creating linked specs and todos from PRDs
- work action that sends linked file paths as required reading context
- worktree creation flow with deterministic branch naming

## Non-Goals

- autonomous model closure of lifecycle states
- unrestricted model access to hidden orchestration CLI

## Constraints

- links in files MUST be repo-relative
- prompt payloads MUST include absolute paths resolved from links.root_abs
- GUI MUST remain lifecycle authority
- checklist progress MUST be boolean and positional
- worktree branch naming MUST follow feat/prd-<slug> or feat/todo-<slug>
- repo discovery MUST scan cwd and descendants for git repositories

## Deliverables

- linked PRD, spec, and todo document set
- GUI prompt handoff contract for work and review
- validation rules for schema and link integrity
- worktree orchestration spec for zero, one, and multi-repo discovery outcomes

## Acceptance Criteria

- one PRD links to two specs and three todos
- all six files share one schema and parse successfully
- work action can resolve and pass all linked paths to model
- repo scan prompts user to select repo when more than one repo is found
- no-repo flow offers initialization and creates initial commit with current files

## Risks

- stale links can break work context handoff
- oversized context can reduce model reliability

## Implementation Notes

Keep status handling simple and user-driven. Use checklist booleans and GUI-derived progress labels for triage.
Treat this file as a template blueprint for generated PRD files under `.pi/plans/prds`.
The full implementation plan MUST remain self-contained within `/plans`.

## Verification Plan

Run schema validation, link traversal checks, and simulated work action payload generation for this PRD and all linked documents.

