{
  "id": "9cf66ca9",
  "title": "[Phase 1] Read-assist: Hash consistency between read and apply",
  "tags": [
    "pi-hash",
    "phase-1",
    "read-tool",
    "hash-consistency"
  ],
  "status": "closed",
  "created_at": "2026-02-12T21:37:18.343Z",
  "assigned_to_session": "5d994b6f-5c75-4f28-8a94-ed305756b8c1"
}

## Completed

Hash consistency between read and apply is already ensured.

### Verification

1. **Same hash function**:
   - Read tool: `import { computeLineHash } from "../shared/hash.js";` (executor.ts:5)
   - Apply patch: `import { computeLineHash } from "./shared/hash.js";` (apply.ts:7)
   - Both use the same function → consistent hashes

2. **Same output format**:
   - Read tool: `` `${lineNo}:${computeLineHash(content)}|${content}` `` (executor.ts:31)
   - Apply patch: `` `${index + 1}:${computeLineHash(lines[index])}|${lines[index]}` `` (apply.ts:172)
   - Both use `LINE:HASH|content` format (2-char hex)

3. **Live anchor updates**:
   - `upsertLive()` function exists in apply.ts (lines 305-315)
   - Called after successful patches (add, update, move)
   - Returns updated anchors in `ApplySummary.live`

### Note

The original todo body mentioned "FNV-1a → base26, 4 chars" and "aaaa" but Phase 0 changed the format to:
- 2-char hex (256 possible values)
- Uses xxHash32 (Bun) or FNV-1a fallback (Node)
- Empty line hash: "00"

### Acceptance Criteria Met

- [x] Read tool hashes match apply_patch hashes (same function)
- [x] Live anchors returned after successful patch (upsertLive function)
- [x] Multi-file reads work correctly (read tool already supports arrays)
